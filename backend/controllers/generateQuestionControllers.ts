import generate from "../config/aiprompt";

import { Request, Response } from 'express';


export const generateQuestions = async (req: Request, res: Response) => {
    try {
        const { exam, subject, topic } = req.body;

        if (!exam || !subject || !topic) {
            return res.status(400).json({ message: 'Exam, subject, and topic are required.' });
        }

        // const result= await generate(exam, subject, topic);
       
        // const text = result.candidates?.[0]?.content?.parts?.[0]?.text ?? null;
        const text="```json\n[\n  {\n    \"question\": \"If vectors \\\\(\\\\vec{a} = 2\\\\hat{i} + \\\\hat{j} - \\\\hat{k}\\\\) and \\\\(\\\\vec{b} = \\\\hat{i} - \\\\hat{j} + p\\\\hat{k}\\\\) are perpendicular, then the value of p is:\",\n    \"options\": {\n      \"A\": \"0\",\n      \"B\": \"1\",\n      \"C\": \"2\",\n      \"D\": \"3\"\n    },\n    \"correctAnswer\": \"B\",\n    \"explanation\": \"Since the vectors are perpendicular, their dot product is zero.  \\\\(\\\\vec{a} \\\\cdot \\\\vec{b} = (2)(1) + (1)(-1) + (-1)(p) = 0\\\\), which gives \\\\(2 - 1 - p = 0\\\\), hence \\\\(p = 1\\\\).\"\n  },\n  {\n    \"question\": \"The area of the parallelogram whose adjacent sides are represented by the vectors \\\\(\\\\vec{a} = \\\\hat{i} + 2\\\\hat{j} + 3\\\\hat{k}\\\\) and \\\\(\\\\vec{b} = -3\\\\hat{i} - 2\\\\hat{j} + \\\\hat{k}\\\\) is:\",\n    \"options\": {\n      \"A\": \"\\\\(3\\\\sqrt{5}\\\\)\",\n      \"B\": \"\\\\(5\\\\sqrt{3}\\\\)\",\n      \"C\": \"\\\\(3\\\\sqrt{3}\\\\)\",\n      \"D\": \"\\\\(8\\\\)\"\n    },\n    \"correctAnswer\": \"B\",\n    \"explanation\": \"The area of the parallelogram is given by \\\\(|\\\\vec{a} \\\\times \\\\vec{b}|\\\\).  \\\\(\\\\vec{a} \\\\times \\\\vec{b} = (2+6)\\\\hat{i} - (1+9)\\\\hat{j} + (-2+6)\\\\hat{k} = 8\\\\hat{i} - 10\\\\hat{j} + 4\\\\hat{k}\\\\). Thus, \\\\(|\\\\vec{a} \\\\times \\\\vec{b}| = \\\\sqrt{8^2 + (-10)^2 + 4^2} = \\\\sqrt{64 + 100 + 16} = \\\\sqrt{180} = \\\\sqrt{36 \\\\times 5} = 6\\\\sqrt{5}\\\\). However, the correct calculation is: (2+6)i - (1+9)j + (-2+6)k = 8i - 10j + 4k. Magnitude = sqrt(64 + 100 + 16) = sqrt(180) = 6sqrt(5). The previously provided answer was incorrect, calculating \\\\(\\\\vec{a} \\\\times \\\\vec{b}\\\\) wrong. Let's recalculate \\\\(\\\\vec{a} \\\\times \\\\vec{b}\\\\) correctly. \\\\(\\\\vec{a} \\\\times \\\\vec{b} = (2(1) - 3(-2))\\\\hat{i} - (1(1) - 3(-3))\\\\hat{j} + (1(-2) - 2(-3))\\\\hat{k} = 8\\\\hat{i} - 10\\\\hat{j} + 4\\\\hat{k}\\\\).  Magnitude is \\\\(\\\\sqrt{64+100+16} = \\\\sqrt{180} = 6\\\\sqrt{5}\\\\).  I apologize for the error. Actually, none of the provided options are correct. I will revise the question.\",\n    \"revised\": true,\n    \"question\": \"The area of the parallelogram whose adjacent sides are represented by the vectors \\\\(\\\\vec{a} = \\\\hat{i} + 2\\\\hat{j} + 3\\\\hat{k}\\\\) and \\\\(\\\\vec{b} = -3\\\\hat{i} - 2\\\\hat{j} + \\\\hat{k}\\\\) is:\",\n    \"options\": {\n      \"A\": \"\\\\(3\\\\sqrt{5}\\\\)\",\n      \"B\": \"\\\\(6\\\\sqrt{5}\\\\)\",\n      \"C\": \"\\\\(5\\\\sqrt{3}\\\\)\",\n      \"D\": \"\\\\(8\\\\)\"\n    },\n    \"correctAnswer\": \"B\",\n    \"explanation\": \"The area of the parallelogram is given by \\\\(|\\\\vec{a} \\\\times \\\\vec{b}|\\\\).  \\\\(\\\\vec{a} \\\\times \\\\vec{b} = (2+6)\\\\hat{i} - (1+9)\\\\hat{j} + (-2+6)\\\\hat{k} = 8\\\\hat{i} - 10\\\\hat{j} + 4\\\\hat{k}\\\\). Thus, \\\\(|\\\\vec{a} \\\\times \\\\vec{b}| = \\\\sqrt{8^2 + (-10)^2 + 4^2} = \\\\sqrt{64 + 100 + 16} = \\\\sqrt{180} = \\\\sqrt{36 \\\\times 5} = 6\\\\sqrt{5}\\\\).\"\n  },\n  {\n    \"question\": \"If \\\\(\\\\vec{a}\\\\) and \\\\(\\\\vec{b}\\\\) are unit vectors and \\\\(\\\\theta\\\\) is the angle between them, then \\\\(\\\\sin(\\\\theta/2)\\\\) is equal to:\",\n    \"options\": {\n      \"A\": \"\\\\(\\\\frac{1}{2}|\\\\vec{a} - \\\\vec{b}|\\\\)\",\n      \"B\": \"\\\\(\\\\frac{1}{2}|\\\\vec{a} + \\\\vec{b}|\\\\)\",\n      \"C\": \"\\\\(|\\\\vec{a} - \\\\vec{b}|\\\\)\",\n      \"D\": \"\\\\(|\\\\vec{a} + \\\\vec{b}|\\\\)\"\n    },\n    \"correctAnswer\": \"A\",\n    \"explanation\": \"We know that \\\\(|\\\\vec{a} - \\\\vec{b}|^2 = |\\\\vec{a}|^2 + |\\\\vec{b}|^2 - 2|\\\\vec{a}||\\\\vec{b}|\\\\cos\\\\theta = 1 + 1 - 2\\\\cos\\\\theta = 2(1 - \\\\cos\\\\theta) = 2(2\\\\sin^2(\\\\theta/2)) = 4\\\\sin^2(\\\\theta/2)\\\\). Therefore, \\\\(\\\\sin(\\\\theta/2) = \\\\frac{1}{2}|\\\\vec{a} - \\\\vec{b}|\\\\).\"\n  },\n  {\n    \"question\": \"Let \\\\(\\\\vec{a} = \\\\hat{i} + \\\\hat{j}\\\\) and \\\\(\\\\vec{b} = 2\\\\hat{i} - \\\\hat{k}\\\\). Then the vector \\\\(\\\\vec{c}\\\\) satisfying \\\\(\\\\vec{a} \\\\times \\\\vec{c} = \\\\vec{b}\\\\) and \\\\(\\\\vec{a} \\\\cdot \\\\vec{c} = 3\\\\) is:\",\n    \"options\": {\n      \"A\": \"\\\\( \\\\frac{5}{2}\\\\hat{i} + \\\\frac{5}{2}\\\\hat{j} + \\\\frac{1}{2}\\\\hat{k} \\\\)\",\n      \"B\": \"\\\\( \\\\frac{5}{3}\\\\hat{i} + \\\\frac{5}{3}\\\\hat{j} + \\\\frac{1}{3}\\\\hat{k} \\\\)\",\n      \"C\": \"\\\\( \\\\frac{5}{2}\\\\hat{i} - \\\\frac{5}{2}\\\\hat{j} - \\\\frac{1}{2}\\\\hat{k} \\\\)\",\n      \"D\": \"\\\\( \\\\frac{5}{3}\\\\hat{i} - \\\\frac{5}{3}\\\\hat{j} - \\\\frac{1}{3}\\\\hat{k} \\\\)\"\n    },\n    \"correctAnswer\": \"A\",\n    \"explanation\": \"Let \\\\(\\\\vec{c} = x\\\\hat{i} + y\\\\hat{j} + z\\\\hat{k}\\\\).  Then \\\\(\\\\vec{a} \\\\cdot \\\\vec{c} = x + y = 3\\\\).  Also, \\\\(\\\\vec{a} \\\\times \\\\vec{c} = (z - 0)\\\\hat{i} - (0 - z)\\\\hat{j} + (y - x)\\\\hat{k} = z\\\\hat{i} + z\\\\hat{j} + (y-x)\\\\hat{k} = 2\\\\hat{i} - \\\\hat{k}\\\\). Thus, \\\\(z = 2\\\\) and \\\\(y - x = -1\\\\).  Solving \\\\(x + y = 3\\\\) and \\\\(y - x = -1\\\\) gives \\\\(2y = 2\\\\), so \\\\(y = 1\\\\) and \\\\(x = 2\\\\). Therefore, \\\\(\\\\vec{c} = 2\\\\hat{i} + 1\\\\hat{j} + 2\\\\hat{k} =  \\\\frac{5}{2}\\\\hat{i} + \\\\frac{5}{2}\\\\hat{j} + \\\\frac{1}{2}\\\\hat{k} \\\\)\"\n  },\n  {\n    \"question\": \"If \\\\(\\\\vec{a}, \\\\vec{b}, \\\\vec{c}\\\\) are unit vectors such that \\\\(\\\\vec{a} + \\\\vec{b} + \\\\vec{c} = \\\\vec{0}\\\\), then the value of \\\\(\\\\vec{a} \\\\cdot \\\\vec{b} + \\\\vec{b} \\\\cdot \\\\vec{c} + \\\\vec{c} \\\\cdot \\\\vec{a}\\\\) is:\",\n    \"options\": {\n      \"A\": \"3\",\n      \"B\": \"-3/2\",\n      \"C\": \"1\",\n      \"D\": \"-1/2\"\n    },\n    \"correctAnswer\": \"B\",\n    \"explanation\": \"Since \\\\(\\\\vec{a} + \\\\vec{b} + \\\\vec{c} = \\\\vec{0}\\\\), we have \\\\(|\\\\vec{a} + \\\\vec{b} + \\\\vec{c}|^2 = 0\\\\).  Expanding, we get \\\\(|\\\\vec{a}|^2 + |\\\\vec{b}|^2 + |\\\\vec{c}|^2 + 2(\\\\vec{a} \\\\cdot \\\\vec{b} + \\\\vec{b} \\\\cdot \\\\vec{c} + \\\\vec{c} \\\\cdot \\\\vec{a}) = 0\\\\).  Since \\\\(\\\\vec{a}, \\\\vec{b}, \\\\vec{c}\\\\) are unit vectors, we have \\\\(1 + 1 + 1 + 2(\\\\vec{a} \\\\cdot \\\\vec{b} + \\\\vec{b} \\\\cdot \\\\vec{c} + \\\\vec{c} \\\\cdot \\\\vec{a}) = 0\\\\).  Thus, \\\\(3 + 2(\\\\vec{a} \\\\cdot \\\\vec{b} + \\\\vec{b} \\\\cdot \\\\vec{c} + \\\\vec{c} \\\\cdot \\\\vec{a}) = 0\\\\), so \\\\(\\\\vec{a} \\\\cdot \\\\vec{b} + \\\\vec{b} \\\\cdot \\\\vec{c} + \\\\vec{c} \\\\cdot \\\\vec{a} = -3/2\\\\).\"\n  },\n  {\n    \"question\": \"Let \\\\(\\\\vec{a} = \\\\hat{i} - \\\\hat{j}\\\\), \\\\(\\\\vec{b} = \\\\hat{j} - \\\\hat{k}\\\\), \\\\(\\\\vec{c} = \\\\hat{k} - \\\\hat{i}\\\\). If \\\\(\\\\vec{d}\\\\) is a unit vector such that \\\\(\\\\vec{a} \\\\cdot \\\\vec{d} = 0\\\\), \\\\(\\\\vec{b} \\\\cdot \\\\vec{d} = 0\\\\), then \\\\(\\\\vec{c} \\\\cdot \\\\vec{d}\\\\) equals:\",\n    \"options\": {\n      \"A\": \"\\\\( \\\\pm \\\\frac{1}{\\\\sqrt{3}} \\\\)\",\n      \"B\": \"\\\\( \\\\pm \\\\frac{1}{\\\\sqrt{2}} \\\\)\",\n      \"C\": \"\\\\( \\\\pm 1 \\\\)\",\n      \"D\": \"0\"\n    },\n    \"correctAnswer\": \"B\",\n    \"explanation\": \"Since \\\\(\\\\vec{a} \\\\cdot \\\\vec{d} = 0\\\\) and \\\\(\\\\vec{b} \\\\cdot \\\\vec{d} = 0\\\\), \\\\(\\\\vec{d}\\\\) is perpendicular to both \\\\(\\\\vec{a}\\\\) and \\\\(\\\\vec{b}\\\\). Thus, \\\\(\\\\vec{d}\\\\) is parallel to \\\\(\\\\vec{a} \\\\times \\\\vec{b}\\\\). We have \\\\(\\\\vec{a} \\\\times \\\\vec{b} = (1)\\\\hat{i} + (1)\\\\hat{j} + (1)\\\\hat{k} = \\\\hat{i} + \\\\hat{j} + \\\\hat{k}\\\\). A unit vector in this direction is \\\\(\\\\vec{d} = \\\\frac{1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})\\\\) or \\\\(\\\\vec{d} = \\\\frac{-1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})\\\\). Therefore, \\\\(\\\\vec{c} \\\\cdot \\\\vec{d} = (\\\\hat{k} - \\\\hat{i}) \\\\cdot \\\\frac{\\\\pm 1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k}) = \\\\frac{\\\\pm 1}{\\\\sqrt{3}} ( -1 + 0 + 1) = 0 \\\\).  However, since \\\\(\\\\vec{c} = -(\\\\vec{a} + \\\\vec{b})\\\\), \\\\(\\\\vec{c} \\\\cdot \\\\vec{d} = -(\\\\vec{a} + \\\\vec{b}) \\\\cdot \\\\vec{d} = -(\\\\vec{a} \\\\cdot \\\\vec{d} + \\\\vec{b} \\\\cdot \\\\vec{d}) = 0\\\\), which indicates something is wrong. If we instead find a vector orthogonal to both \\\\(a\\\\) and \\\\(b\\\\), it would have to be in the form \\\\(x\\\\hat{i}+x\\\\hat{j}+x\\\\hat{k}\\\\). For it to be a *unit* vector, we divide by the magnitude \\\\(\\\\sqrt{3x^2} = x\\\\sqrt{3}\\\\), which results in \\\\(\\\\frac{1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})\\\\). If \\\\(\\\\vec{c} = (0,0,1) - (1,0,0) = (-1, 0, 1)\\\\) \\\\(\\\\vec{c} \\\\cdot \\\\vec{d} = (-1+0+1)/\\\\sqrt{3} = 0\\\\). We made another mistake. The condition is that \\\\(\\\\vec{a}\\\\cdot \\\\vec{d} = 0\\\\) and \\\\(\\\\vec{b}\\\\cdot \\\\vec{d} = 0\\\\) . Since \\\\( \\\\vec{d} \\\\) has to be a unit vector, \\\\(\\\\vec{d} = x\\\\hat{i} + y\\\\hat{j} + z\\\\hat{k}\\\\). Thus \\\\( x - y = 0\\\\) and \\\\(y-z = 0\\\\) so \\(x=y=z\\). So \\\\(3x^2=1\\\\) , then \\\\( x=\\\\frac{1}{\\\\sqrt{3}} \\\\). So the vector is \\\\( \\\\frac{1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})\\\\). Thus \\\\(\\\\vec{c} \\\\cdot \\\\vec{d} = (\\\\hat{k} - \\\\hat{i}) \\\\cdot  \\\\frac{1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})  = (1-1)/\\\\sqrt{3} = 0\\\\) . Let's verify the problem again. It means c is also orthogonal with \\\\( \\\\vec{d} \\\\). However \\\\( \\\\vec{c} = - \\\\vec{a} - \\\\vec{b} \\\\), so \\\\( \\\\vec{c} \\\\cdot \\\\vec{d} = 0\\\\). It must be a problem that \\\\(x - y = 0\\\\) and \\\\( y - z = 0\\\\).\n\nIf we chose \\\\(\\\\vec{d} = \\\\pm \\\\frac{1}{\\\\sqrt{2}} (\\\\hat{i} + \\\\hat{k})\\\\), Then \\\\( (1,-1,0) \\\\cdot (1,0,1) = 1 != 0\\\\).\n\nThe final answer is \\\\(  \\\\vec{d} = \\\\pm \\\\frac{1}{\\\\sqrt{2}} \\\\).\n\",\n  \"revised\": true,\n  \"question\": \"Let \\\\(\\\\vec{a} = \\\\hat{i} - \\\\hat{j}\\\\), \\\\(\\\\vec{b} = \\\\hat{j} - \\\\hat{k}\\\\). If \\\\(\\\\vec{d}\\\\) is a unit vector such that \\\\(\\\\vec{a} \\\\cdot \\\\vec{d} = 0\\\\) and \\\\(\\\\vec{b} \\\\cdot \\\\vec{d} = 0\\\\), then the absolute value of \\\\(\\\\vec{c} \\\\cdot \\\\vec{d}\\\\) , where \\\\(\\\\vec{c} = \\\\hat{k} - \\\\hat{i}\\\\) equals:\",\n    \"options\": {\n      \"A\": \"\\\\( \\\\frac{2}{\\\\sqrt{6}} \\\\)\",\n      \"B\": \"\\\\( \\\\frac{1}{\\\\sqrt{2}} \\\\)\",\n      \"C\": \"\\\\( \\\\frac{2}{\\\\sqrt{3}} \\\\)\",\n      \"D\": \"\\\\( \\\\frac{2}{\\\\sqrt{2}} \\\\)\"\n    },\n    \"correctAnswer\": \"C\",\n    \"explanation\": \"Since \\\\(\\\\vec{a} \\\\cdot \\\\vec{d} = 0\\\\) and \\\\(\\\\vec{b} \\\\cdot \\\\vec{d} = 0\\\\), \\\\(\\\\vec{d}\\\\) is perpendicular to both \\\\(\\\\vec{a}\\\\) and \\\\(\\\\vec{b}\\\\). Thus, \\\\(\\\\vec{d}\\\\) is parallel to \\\\(\\\\vec{a} \\\\times \\\\vec{b}\\\\). We have \\\\(\\\\vec{a} \\\\times \\\\vec{b} = \\\\hat{i} + \\\\hat{j} + \\\\hat{k}\\\\). A unit vector in this direction is \\\\(\\\\vec{d} = \\\\frac{1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})\\\\) or \\\\(\\\\vec{d} = \\\\frac{-1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k})\\\\). Therefore, \\\\(\\\\vec{c} \\\\cdot \\\\vec{d} = (\\\\hat{k} - \\\\hat{i}) \\\\cdot \\\\frac{\\\\pm 1}{\\\\sqrt{3}}(\\\\hat{i} + \\\\hat{j} + \\\\hat{k}) = \\\\frac{\\\\pm 1}{\\\\sqrt{3}} ( -1 + 0 + 1) =  \\\\pm (\\\\frac{-1}{\\\\sqrt{3}} + \\\\frac{1}{\\\\sqrt{3}})  \\\\).  \\\\(\\\\frac{\\\\vec{a} \\\\times \\\\vec{b}}{|| \\\\vec{a} \\\\times \\\\vec{b} ||} = (1,1,1)/ \\\\sqrt{3}\\\\) So we compute \\\\((0,0,1) - (1,0,0)) \\\\cdot (1,1,1)/ \\\\sqrt{3} = -1/\\\\sqrt{3} + 1/\\\\sqrt{3} = 0\\\\).  Let's verify the problem again. If \\\\(\\\\vec{c} = - (\\\\vec{a} + \\\\vec{b}) = - (\\\\hat{i} - \\\\hat{j} + \\\\hat{j} - \\\\hat{k}) = - (\\\\hat{i} - \\\\hat{k}) = (\\\\hat{k} - \\\\hat{i})\\\\). If \\\\(\\\\vec{d}\\\\) must orthogonal to both a and b , then x-y = 0 and y-z = 0 so x = y = z , hence any unit vector has the form \\\\(x\\\\hat{i} + x\\\\hat{j} +x\\\\hat{k}) , where x^2 = 1/3.  \\\\(\\\\frac{1}{\\\\sqrt{3}} (1,1,1)  =  -\\\\hat{i} + \\\\hat{k} \\\\cdot \\\\vec{d}= \\\\frac{1}{\\\\sqrt{3}} (1,1,1)\\\\) then this quantity is zero.  Oh! Since \\\\(\\\\hat{i} - \\\\hat{k} \\\\cdot \\frac{1}{\\\\sqrt{3}} (1,1,1)  = -(\\\\frac{1}{\\\\sqrt{3}}) + (\\\\frac{1}{\\\\sqrt{3}}) = 0 \\\\) it is.  Let \\\\(\\\\vec{a} \\\\cross \\\\vec{b} = \\\\hat{i} + \\\\hat{j} + \\\\hat{k}\\\\), and then |(\\\\vec{a} \\\\cross \\\\vec{b})| = \\\\sqrt{3}\\\\). Then the unit normal vector is \\\\( \\\\hat{n} = (\\\\hat{i} + \\\\hat{j} + \\\\hat{k})/\\\\sqrt{3} \\\\).  This is also orthogonal to the vector (1, 0, -1) \\\\(\\\\hat{k} - \\\\hat{i}\\\\), meaning we made an error. We can try (\\\\hat{i} = (1,0,0).  However \\\\(\\\\vec{d}\\\\) is meant to satisfy the property. Actually, since \\\\(\\\\vec{c} = - \\\\vec{a} - \\\\vec{b}\\\\) so \\\\(\\\\vec{c} \\\\cdot \\\\vec{d} = 0\\\\).\n\n\",\n        }\n        ]\n";

        return res.status(200).json(
            text ? text : 'No questions generated'
            // text ? text : result.text || 'No questions generated'
        );
    } catch (error) {
        console.error('Error generating questions:', error);
        return res.status(500).json({ message: 'Internal server error' });
    }   
}